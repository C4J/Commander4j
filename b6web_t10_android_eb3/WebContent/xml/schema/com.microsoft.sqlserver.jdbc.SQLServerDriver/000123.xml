<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE DDL SYSTEM "schema.dtd">
<DDL>

<statement>
		ALTER VIEW [dbo].[view_label_data_process_order_cdf]
		AS
		SELECT PO.PROCESS_ORDER, PO.STATUS, PO.MATERIAL, PO.REQUIRED_UOM, PO.REQUIRED_RESOURCE, PO.DUE_DATE, MAT.MATERIAL_TYPE, MAT.DESCRIPTION, RIGHT('00000000000000' + MATUOM_PROD.EAN, 14) 
		                  AS PROD_EAN, RIGHT('00' + MATUOM_PROD.VARIANT, 2) AS PROD_VARIANT, MATUOM_BASE.NUMERATOR AS PROD_QUANTITY, RIGHT('00000000000000' + ISNULL(PART2.DATA,''), 14) AS BASE_EAN, 
		                  RIGHT('00' + ISNULL(PART4.DATA,''), 2) AS BASE_VARIANT, ISNULL(PART3.DATA, 0) AS BASE_QUANTITY, dbo.c4j_GetFullPalletQuantity(PO.PROCESS_ORDER) AS PALLET_QUANTITY, 
		                  dbo.c4j_GetLayers(PO.PROCESS_ORDER) AS PALLET_LAYERS, MAT.OLD_MATERIAL, MAT.SHELF_LIFE, MAT.SHELF_LIFE_UOM, MAT.SHELF_LIFE_RULE, PO.CUSTOMER_ID, CUST.CUSTOMER_NAME, 
		                  dbo.c4j_GetFinalBatchNumber(GETDATE(), 'N', '', '', PO.PROCESS_ORDER) AS BATCH_NUMBER, dbo.c4j_GetFinalExpiryDate(GETDATE(), MAT.SHELF_LIFE, MAT.SHELF_LIFE_UOM, MAT.SHELF_LIFE_RULE, 'N', 
		                  GETDATE()) AS EXPIRY_DATE, MAT.UPDATED AS MATERIAL_UPDATED, PO.UPDATED AS PROCESS_ORDER_UPDATED, ISNULL(PART1.DATA, '') AS PART_NO,ISNULL(PART0.DATA, '') AS CASE_CONTENT,
		                  ISNULL(CUST.CUSTOMER_DATA_01,'') AS CASE__LABEL,ISNULL(CUST.CUSTOMER_DATA_02,'') AS PALLET__LABEL,CUST.UPDATED AS CUSTOMER_UPDATED
		FROM     dbo.APP_PROCESS_ORDER AS PO INNER JOIN
		                  dbo.APP_MATERIAL AS MAT ON MAT.MATERIAL = PO.MATERIAL INNER JOIN
		                  dbo.APP_CUSTOMER AS CUST ON CUST.CUSTOMER_ID = PO.CUSTOMER_ID INNER JOIN
		                  dbo.APP_MATERIAL_UOM AS MATUOM_PROD ON MATUOM_PROD.MATERIAL = PO.MATERIAL AND MATUOM_PROD.UOM = PO.REQUIRED_UOM INNER JOIN
		                  dbo.APP_MATERIAL_UOM AS MATUOM_BASE ON MATUOM_BASE.MATERIAL = PO.MATERIAL AND MATUOM_BASE.UOM = MAT.BASE_UOM LEFT OUTER JOIN
		                  dbo.APP_MATERIAL_CUSTOMER_DATA AS PART3 ON PO.MATERIAL = PART3.MATERIAL AND PO.CUSTOMER_ID = PART3.CUSTOMER_ID AND PART3.DATA_ID = 'CU_QUANTITY' LEFT OUTER JOIN
		                  dbo.APP_MATERIAL_CUSTOMER_DATA AS PART2 ON PO.MATERIAL = PART2.MATERIAL AND PO.CUSTOMER_ID = PART2.CUSTOMER_ID AND PART2.DATA_ID = 'CU_EAN' LEFT OUTER JOIN
		                  dbo.APP_MATERIAL_CUSTOMER_DATA AS PART4 ON PO.MATERIAL = PART4.MATERIAL AND PO.CUSTOMER_ID = PART4.CUSTOMER_ID AND PART4.DATA_ID = 'CU_VARIANT' LEFT OUTER JOIN
		                  dbo.APP_MATERIAL_CUSTOMER_DATA AS PART1 ON PO.MATERIAL = PART1.MATERIAL AND PO.CUSTOMER_ID = PART1.CUSTOMER_ID AND PART1.DATA_ID = 'PART_NO' LEFT OUTER JOIN
		                  dbo.APP_MATERIAL_CUSTOMER_DATA AS PART0 ON PO.MATERIAL = PART0.MATERIAL AND PO.CUSTOMER_ID = PART0.CUSTOMER_ID AND PART0.DATA_ID = 'CASE_CONTENT'
</statement>


	<statement>
		ALTER VIEW [dbo].[view_pallet_expiry] AS (SELECT 
		p.SSCC, 
		p.LOCATION_ID, 
		p.MATERIAL, 
		p.BATCH_NUMBER, 
		p.PROCESS_ORDER,
		p.QUANTITY,
		p.UOM,
		p.DATE_OF_MANUFACTURE,
		p.STATUS,
		p.EAN, 
	    p.VARIANT, 
	    p.DESPATCH_NO, 
	    p.CONFIRMED, 
	    p.LAYERS, 
	    p.SSCC_EXPIRY_DATE, 
	    p.CUSTOMER_ID, 
	    p.MHN_NUMBER, 
	    p.DECISION, 
	    b.EXPIRY_DATE, 
	    m.DESCRIPTION,
	    m.OLD_MATERIAL,
	    c.CUSTOMER_NAME,
	    c.PRINT_ON_LABEL,
	    p.DATE_CREATED,
	    p.CREATED_BY_USER_ID,
	    p.DATE_UPDATED,
	    p.UPDATED_BY_USER_ID,
	    m.GROSS_WEIGHT,
	    m.NET_WEIGHT,
	    m.WEIGHT_UOM,
		d.DATA as PART_NO,
		e.DATA as CASE_CONTENT
	    FROM dbo.APP_PALLET AS p 
	    LEFT JOIN  dbo.APP_MATERIAL_BATCH AS b ON p.MATERIAL = b.MATERIAL AND p.BATCH_NUMBER = b.BATCH_NUMBER 
	    LEFT JOIN  dbo.APP_MATERIAL AS m ON p.MATERIAL = m.MATERIAL 
	    LEFT JOIN  dbo.APP_CUSTOMER AS c ON p.CUSTOMER_ID = c.CUSTOMER_ID
		LEFT JOIN  dbo.APP_MATERIAL_CUSTOMER_DATA as d on d.MATERIAL = p.MATERIAL AND d.CUSTOMER_ID = p.CUSTOMER_ID and d.DATA_ID = 'PART_NO'
		LEFT JOIN  dbo.APP_MATERIAL_CUSTOMER_DATA as e on e.MATERIAL = p.MATERIAL AND e.CUSTOMER_ID = p.CUSTOMER_ID and e.DATA_ID = 'CASE_CONTENT')
	</statement>

	
</DDL>

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE DDL SYSTEM "schema.dtd">
<DDL>
	
   <statement>        
		ALTER VIEW [dbo].[VIEW_PALLET_EXPIRY] AS (SELECT
			p.SSCC, 
			p.LOCATION_ID, 
			p.MATERIAL, 
			p.BATCH_NUMBER, 
			p.PROCESS_ORDER, 
			p.QUANTITY, 
			p.UOM, 
			p.DATE_OF_MANUFACTURE, 
			p.STATUS, 
			p.EAN, 
			p.VARIANT, 
			p.DESPATCH_NO, 
			p.CONFIRMED, 
			p.LAYERS, 
			p.SSCC_EXPIRY_DATE, 
			p.CUSTOMER_ID, 
			p.MHN_NUMBER, 
			p.DECISION, 
			b.EXPIRY_DATE, 
			m.DESCRIPTION, 
			m.OLD_MATERIAL, 
			c.CUSTOMER_NAME, 
			c.PRINT_ON_LABEL, 
			p.DATE_CREATED, 
			p.CREATED_BY_USER_ID, 
			p.DATE_UPDATED, 
			p.UPDATED_BY_USER_ID, 
			p.EQUIPMENT_TYPE, 
			m.GROSS_WEIGHT, 
			m.NET_WEIGHT, 
			m.WEIGHT_UOM, 
			d.DATA AS PART_NO, 
			e.DATA AS CASE_CONTENT, 
			o.REQUIRED_RESOURCE AS REQUIRED_RESOURCE, 
			u2.EAN AS BASE_EAN, 
			u2.VARIANT AS BASE_VARIANT, 
			m.BASE_UOM AS BASE_UOM, 
			((p.QUANTITY * u.NUMERATOR) / u.DENOMINATOR) AS BASE_QUANTITY
		FROM
			dbo.APP_PALLET AS p
			LEFT JOIN
			dbo.APP_MATERIAL_BATCH AS b
			ON 
				p.MATERIAL = b.MATERIAL AND
				p.BATCH_NUMBER = b.BATCH_NUMBER
			LEFT JOIN
			dbo.APP_MATERIAL AS m
			ON 
				p.MATERIAL = m.MATERIAL
			LEFT JOIN
			dbo.APP_CUSTOMER AS c
			ON 
				p.CUSTOMER_ID = c.CUSTOMER_ID
			LEFT JOIN
			dbo.APP_PROCESS_ORDER AS o
			ON 
				p.PROCESS_ORDER = o.PROCESS_ORDER
			LEFT JOIN
			dbo.APP_MATERIAL_CUSTOMER_DATA AS d
			ON 
				d.MATERIAL = p.MATERIAL AND
				d.CUSTOMER_ID = p.CUSTOMER_ID AND
				d.DATA_ID = 'PART_NO'
			LEFT JOIN
			dbo.APP_MATERIAL_CUSTOMER_DATA AS e
			ON 
				e.MATERIAL = p.MATERIAL AND
				e.CUSTOMER_ID = p.CUSTOMER_ID AND
				e.DATA_ID = 'CASE_CONTENT'
			LEFT JOIN
			dbo.APP_MATERIAL_UOM AS u
			ON 
				p.UOM = u.UOM AND
				p.MATERIAL = u.MATERIAL
			LEFT JOIN
			dbo.APP_MATERIAL_UOM AS u2
			ON 
				m.MATERIAL = u2.MATERIAL AND
				m.BASE_UOM = u2.UOM)
    </statement>
		
</DDL>
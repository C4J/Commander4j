<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE DDL SYSTEM "schema.dtd">
<DDL>

<statement>
	ALTER TABLE `APP_LABEL_DATA` ADD COLUMN `LAYERS` INT(10) NULL DEFAULT '0' AFTER `LINE`
</statement>

	<statement>
		ALTER VIEW view_auto_labeller_printer AS
			SELECT        APP_AUTO_LABELLER.LINE, APP_AUTO_LABELLER.MODIFIED, APP_AUTO_LABELLER.UNIQUE_ID, APP_LABEL_DATA.LABEL_TYPE, 
		                         SYS_PRINTER_LINE_MEMBERSHIP.PRINTER_ID, SYS_PRINTERS.ENABLED, SYS_PRINTERS.PRINTER_TYPE, SYS_PRINTERS.IP_ADDRESS, 
		                         SYS_PRINTERS.PORT, SYS_PRINTERS.GROUP_ID, SYS_PRINTERS.LANGUAGE, SYS_PRINTERS.PRINTER_DPI, 
		                         APP_LABEL_DATA.PROCESS_ORDER, APP_LABEL_DATA.MATERIAL, APP_LABEL_DATA.MATERIAL_TYPE, 
		                         APP_MATERIAL.DESCRIPTION AS MATERIAL_DESCRIPTION, APP_MATERIAL.SHELF_LIFE_UOM, APP_MATERIAL.SHELF_LIFE, 
		                         APP_MATERIAL.SHELF_LIFE_RULE, APP_LABEL_DATA.BATCH_NUMBER, APP_LABEL_DATA.REQUIRED_RESOURCE,
		                             (SELECT        KEY_VALUE
		                               FROM            SYS_CONTROL
		                               WHERE        (SYSTEM_KEY = 'PLANT')) AS PLANT, APP_LABEL_DATA.LOCATION_ID, APP_LABEL_DATA.DATE_OF_MANUFACTURE, 
		                         APP_LABEL_DATA.EXPIRY_DATE, APP_LABEL_DATA.PROD_EAN, APP_LABEL_DATA.PROD_VARIANT, APP_LABEL_DATA.PROD_QUANTITY, 
		                         APP_LABEL_DATA.PROD_UOM, APP_LABEL_DATA.BASE_EAN, APP_LABEL_DATA.BASE_VARIANT, APP_LABEL_DATA.BASE_QUANTITY, 
		                         APP_LABEL_DATA.BASE_UOM, APP_LABEL_DATA.CUSTOMER_ID, APP_CUSTOMER.CUSTOMER_NAME, APP_LABEL_DATA.PRINT_COPIES, 
		                         APP_LABEL_DATA.MODULE_ID, APP_LABEL_DATA.OVERRIDE_MANUFACTURE_DATE, APP_LABEL_DATA.OVERRIDE_EXPIRY_DATE, 
		                         APP_LABEL_DATA.OVERRIDE_BATCH_PREFIX, APP_LABEL_DATA.BATCH_PREFIX, APP_LABEL_DATA.BATCH_SUFFIX, 
		                         SYS_MODULES.REPORT_TYPE, SYS_MODULES.MODULE_TYPE, SYS_MODULES.REPORT_FILENAME, 
		                         APP_MATERIAL_CUSTOMER_DATA.DATA AS PART_NO,APP_LABEL_DATA.LAYERS
		FROM            APP_AUTO_LABELLER INNER JOIN
		                         SYS_PRINTER_LINE_MEMBERSHIP ON APP_AUTO_LABELLER.LINE = SYS_PRINTER_LINE_MEMBERSHIP.LINE AND 
		                         APP_AUTO_LABELLER.GROUP_ID = SYS_PRINTER_LINE_MEMBERSHIP.GROUP_ID INNER JOIN
		                         SYS_PRINTERS ON SYS_PRINTER_LINE_MEMBERSHIP.PRINTER_ID = SYS_PRINTERS.PRINTER_ID AND 
		                         SYS_PRINTER_LINE_MEMBERSHIP.GROUP_ID = SYS_PRINTERS.GROUP_ID INNER JOIN
		                         APP_LABEL_DATA ON APP_LABEL_DATA.UNIQUE_ID = APP_AUTO_LABELLER.UNIQUE_ID INNER JOIN
		                         APP_MATERIAL ON APP_MATERIAL.MATERIAL = APP_LABEL_DATA.MATERIAL INNER JOIN
		                         APP_CUSTOMER ON APP_LABEL_DATA.CUSTOMER_ID = APP_CUSTOMER.CUSTOMER_ID INNER JOIN
		                         SYS_MODULES ON APP_LABEL_DATA.MODULE_ID = SYS_MODULES.MODULE_ID LEFT OUTER JOIN
		                         APP_MATERIAL_CUSTOMER_DATA ON APP_LABEL_DATA.MATERIAL = APP_MATERIAL_CUSTOMER_DATA.MATERIAL AND 
		                         APP_LABEL_DATA.CUSTOMER_ID = APP_MATERIAL_CUSTOMER_DATA.CUSTOMER_ID AND 
		                         APP_MATERIAL_CUSTOMER_DATA.DATA_ID = 'PART_NO'
		WHERE        (SYS_PRINTERS.ENABLED = 'Y')
	</statement>
		
</DDL>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_171) on Wed Aug 26 14:53:22 BST 2020 -->
<title>net.sf.saxon.query</title>
<meta name="date" content="2020-08-26">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="net.sf.saxon.query";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../net/sf/saxon/pull/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../../net/sf/saxon/regex/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?net/sf/saxon/query/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="Package" class="title">Package&nbsp;net.sf.saxon.query</h1>
<div class="docSummary">
<div class="block">This package provides a relatively low-level API for executing XQuery queries
    directly from a Java application.</div>
</div>
<p>See:&nbsp;<a href="#package.description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Interface Summary table, listing interfaces, and an explanation">
<caption><span>Interface Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Interface</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/Declaration.html" title="interface in net.sf.saxon.query">Declaration</a></td>
<td class="colLast">
<div class="block">This interface represents the union of global variable declarations and function declarations in XQuery
 modules</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/UpdateAgent.html" title="interface in net.sf.saxon.query">UpdateAgent</a></td>
<td class="colLast">
<div class="block">An UpdateAgent is a callback class that is called to handle a document after it has been updated.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/XQueryFunctionBinder.html" title="interface in net.sf.saxon.query">XQueryFunctionBinder</a></td>
<td class="colLast">
<div class="block">XQueryFunctionBinder is an extension of the FunctionLibrary interface used for function libraries
 that contain user-written XQuery functions.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/Annotation.html" title="class in net.sf.saxon.query">Annotation</a></td>
<td class="colLast">
<div class="block">This class represents an annotation that appears in a function or variable declarations</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/AnnotationList.html" title="class in net.sf.saxon.query">AnnotationList</a></td>
<td class="colLast">
<div class="block">An immutable list of function or variable annotations, or of annotation assertions</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/DynamicQueryContext.html" title="class in net.sf.saxon.query">DynamicQueryContext</a></td>
<td class="colLast">
<div class="block">This object represents a dynamic context for query execution.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/ImportedFunctionLibrary.html" title="class in net.sf.saxon.query">ImportedFunctionLibrary</a></td>
<td class="colLast">
<div class="block">This implementation of FunctionLibrary contains all the functions imported into a Query Module.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/QueryLibrary.html" title="class in net.sf.saxon.query">QueryLibrary</a></td>
<td class="colLast">
<div class="block">A QueryLibrary represents an independently compiled set of query modules that does not include a
 main module.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/QueryModule.html" title="class in net.sf.saxon.query">QueryModule</a></td>
<td class="colLast">
<div class="block">This class represents a query module, and includes information about the static context of the query module.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/QueryReader.html" title="class in net.sf.saxon.query">QueryReader</a></td>
<td class="colLast">
<div class="block">This class contains static methods used to read a query as a byte stream, infer the encoding if
 necessary, and return the text of the query as a string; also methods to import functions and variables
 from one module into another, and check their consistency.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/QueryResult.html" title="class in net.sf.saxon.query">QueryResult</a></td>
<td class="colLast">
<div class="block">This utility class takes the result sequence produced by a query, and wraps it as
 an XML document.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/SequenceWrapper.html" title="class in net.sf.saxon.query">SequenceWrapper</a></td>
<td class="colLast">
<div class="block">This class can be used in a push pipeline: it accepts any sequence as input, and generates
 a document in which the items of the sequence are wrapped by elements containing information about
 the types of the items in the input sequence.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/StaticQueryContext.html" title="class in net.sf.saxon.query">StaticQueryContext</a></td>
<td class="colLast">
<div class="block">StaticQueryContext contains information used to build a StaticContext for use when processing XQuery
 expressions.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/UnboundFunctionLibrary.html" title="class in net.sf.saxon.query">UnboundFunctionLibrary</a></td>
<td class="colLast">
<div class="block">An UnboundFunctionLibrary is not a real function library; rather, it is used to keep track of function calls
 that cannot yet be bound to a known declared function, but will have to be bound when all user-declared functions
 are available.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/UndeclaredVariable.html" title="class in net.sf.saxon.query">UndeclaredVariable</a></td>
<td class="colLast">
<div class="block">An UndeclaredVariable object is created when a reference is encountered to a variable
 that has not yet been declared.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/XQueryExpression.html" title="class in net.sf.saxon.query">XQueryExpression</a></td>
<td class="colLast">
<div class="block">XQueryExpression represents a compiled query.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/XQueryFunction.html" title="class in net.sf.saxon.query">XQueryFunction</a></td>
<td class="colLast">
<div class="block">A user-defined function in an XQuery module</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/XQueryFunctionLibrary.html" title="class in net.sf.saxon.query">XQueryFunctionLibrary</a></td>
<td class="colLast">
<div class="block">An XQueryFunctionLibrary is a function library containing all the user-defined functions available for use within a
 particular XQuery module: that is, the functions declared in that module, and the functions imported from other
 modules.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/XQueryFunctionLibrary.UnresolvedCallable.html" title="class in net.sf.saxon.query">XQueryFunctionLibrary.UnresolvedCallable</a></td>
<td class="colLast">
<div class="block">Inner class containing information about a reference to a function whose declaration
 has not yet been encountered.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/XQueryParser.html" title="class in net.sf.saxon.query">XQueryParser</a></td>
<td class="colLast">
<div class="block">This class defines extensions to the XPath parser to handle the additional
 syntax supported in XQuery</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../net/sf/saxon/query/XQueryParser.Unescaper.html" title="class in net.sf.saxon.query">XQueryParser.Unescaper</a></td>
<td class="colLast">&nbsp;</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package.description">
<!--   -->
</a>
<h2 title="Package net.sf.saxon.query Description">Package net.sf.saxon.query Description</h2>
<div class="block"><p>This package provides a relatively low-level API for executing XQuery queries
    directly from a Java application. This is no longer the recommended API for writing Java
    applications using XQuery: there are two higher-level APIs, s9api (<a href="../../../../net/sf/saxon/s9api/package-summary.html"><code>net.sf.saxon.s9api</code></a>),
    and XQJ (<a href="../../../../javax/xml/xquery/package-summary.html"><code>javax.xml.xquery</code></a>). This package also includes internal supporting code
    that implements XQuery within Saxon.</p>

<p>For details of the API, see the JavaDoc documentation of individual classes, starting
    with the <a href="../../../../net/sf/saxon/query/StaticQueryContext.html" title="class in net.sf.saxon.query"><code>StaticQueryContext</code></a>.</p>

<p>The first thing you need to do is to create a <a href="../../../../net/sf/saxon/Configuration.html" title="class in net.sf.saxon"><code>Configuration</code></a> object.
    This holds values of all the system settings, corresponding to flags available on the command line.
    You don't need to set any properties in the <code>Configuration</code> object if you are happy
    with the default settings. For schema-aware processing, you will need to create a
    <a href="../../../../com/saxonica/config/EnterpriseConfiguration.html" title="class in com.saxonica.config"><code>EnterpriseConfiguration</code></a> instead.</p>

<p>Then you need to create a <a href="../../../../net/sf/saxon/query/StaticQueryContext.html" title="class in net.sf.saxon.query"><code>StaticQueryContext</code></a> object, which you can
    do using the <code>newStaticQueryContext()</code> method on the <code>Configuration</code>. As the name
    implies, this holds information about the static (compile-time) context for a query. Most aspects
    of the static context can be defined in the Query Prolog, but this object allows you to initialize
    the static context from the application instead if you need to. Some of the facilities provided are
    very much for advanced users only, for example the ability to declare variables and functions, and
    the ability to specify a <code>NamePool</code> to be used. One aspect of the static context that you may need
    to use is the ability to declare collations. Using the method <code>declareCollation</code> you can
    create a mapping between a collation URI (which can then be used anywhere in the Query) and a Java
    <code>StringCollator</code> object used to implement that collation.</p>

<p>Having created, and possibly configured, the <code>Configuration</code> and
    <code>StaticQueryContext</code> objects, you can now compile a Query using the <code>compileQuery</code>
    method on the <code>StaticQueryContext</code>. The text of the
    Query can be supplied either as a <code>String</code> or as a Java <code>Reader</code>. There
    are thus two different <code>compileQuery</code> methods. Each of them returns the compiled
    query in the form of a <code>XQueryExpression</code>. The <code>XQueryExpression</code>, as you would expect,
    can be executed repeatedly, as often as you want, in the same or in different threads.</p>

<p>Before you run your query, you may want to build one or more trees representing
    XML documents that can be used as input to your query. You don't need to do this: if the query
    loads its source documents using the <code>doc()</code> function then this will be done
    automatically, but doing it yourself gives you more control. A document node at the root of
    a tree is represented in Saxon by the <a href="../../../../net/sf/saxon/om/TreeInfo.html" title="interface in net.sf.saxon.om"><code>TreeInfo</code></a> interface.
    </p>

<p>To execute your compiled query, you need to create a <a href="../../../../net/sf/saxon/query/DynamicQueryContext.html" title="class in net.sf.saxon.query"><code>DynamicQueryContext</code></a> object
    that holds the run-time context information. The main things you can set in the run-time context are:</p>

<ul>
    <li>Values of parameters (external global variables). You can set these using the <code>setParameter()</code>
        method. The mappings from Java classes to XQuery/XPath data types is the same as the mapping used for the
        returned values from an external Java method call, and is described under
        <a href="extensibility.html#function-result">Result of an Extension Function</a>.
    </li>
    <li>The context item can be set using the method <code>setContextItem()</code>.
    </li>
    <li>You can also set a URIResolver and/or ErrorListener. These default to the ones that were
        used during Query compilation.
    </li>
</ul>

<p>You are now ready to evaluate the query. There are several methods on the <code>QueryExpression</code>
    object that you can use to achieve this. The <code>evaluate()</code> method returns the result sequence
    as a Java <code>java.util.List</code>. The <code>evaluateSingle()</code> method is suitable when you know
    that the result sequence will contain a single item: this returns this item as an Object, or returns null
    if the result is an empty sequence. There is also an <code>iterator</code> method that returns an iterator
    over the results. This is a Saxon object of class <code>net.sf.saxon.SequenceIterator</code>: it is similar
    to the standard Java iterator, but not quite identical; for example, it can throw exceptions.</p>

<p>The <code>evaluate()</code> and <code>evaluateSingle()</code> methods return the result as a Java object
    of the most appropriate type: for example a String is returned as a <code>java.lang.String</code>, a
    boolean as a <code>java.lang.Boolean</code>. A node is returned using the Saxon representation of a node,
    <code>net.sf.saxon.om.NodeInfo</code>. With the standard and tinytree models, this object also implements
    the DOM <code>Node</code> interface (but any attempt to update the node throws an error).</p>

<p>The <code>iterator()</code> method, by contrast, does not do any conversion of the result. It is returned
    using its native Saxon representation, for example a String is returned as an instance of
    <code>sf.net.saxon.value.StringValue</code>. You can then use all the methods available on this class
    to process the returned value.</p>

<p>If you want to process the results of the query in your application, that's all there is to it. But you
    may want to output the results as serialized XML. Saxon provides two ways of doing this: you can produce
    wrapped output, or raw output. Raw output works only if the result consists of a single document or element
    node, and it outputs the subtree rooted at that element node in the form of a serialized XML document. Wrapped
    output works for any result sequence, for example a sequence of integers or a sequence of attribute and
    comment nodes; this works by wrapping each item in the result sequence as an XML element, with details
    of its type and value.</p>

<p>To produce wrapped output, you first wrap the result sequence as an XML tree, and then serialize the
    tree. To produce unwrapped output, you skip the wrapping stage and just call the serializer directly.</p>

<p>Both steps can be done using the <code>QueryResult</code> class. This class doesn't need to be
    instantiated, its methods are static. The method <code>QueryResult.wrap</code> takes as input the iterator
    produced by evaluating the query using the <code>iterator()</code> method, and produces as output
    a <code>DocumentInfo</code> object representing the results wrapped as an XML tree. The method
    <code>QueryResult.serialize</code> takes any document or element node as input, and writes it to
    a specified destination, using specified output properties. The destination is supplied as an object
    of class <code>javax.xml.transform.Result</code>. Like the <code>Source</code>, this is part of the
    JAXP API, and allows the destination to be specified as a StreamResult (representing a byte stream or
    character stream), a SAXResult (which wraps a SAX ContentHandler), or a DOMResult
    (which delivers the result as a DOM). The output properties are used only when writing to
    a StreamResult: they correspond to the properties available in the <code>xsl:output</code> element
    for XSLT. The property names are defined by constants in the JAXP <code>javax.xml.transform.OutputKeys</code>
    class (or <code>net.sf.saxon.event.SaxonOutputKeys</code> for Saxon extensions): for details of the
    values that are accepted, see the JavaDoc documentation or the JAXP specification.</p></div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../net/sf/saxon/pull/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../../net/sf/saxon/regex/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?net/sf/saxon/query/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright (c) 2004-2020 Saxonica Limited. All rights reserved.</small></p>
</body>
</html>

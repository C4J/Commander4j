<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE DDL SYSTEM "schema.dtd">
<DDL>

<statement>ALTER VIEW [dbo].[view_auto_labeller_printer] 
  AS SELECT
  AUTOLAB.LINE,
  AUTOLAB.MODIFIED,
  AUTOLAB.UNIQUE_ID,
  LABDATA.LABEL_TYPE,
  MEMBER.PRINTER_ID,
  PRINTERS.ENABLED,
  PRINTERS.PRINTER_TYPE,
  PRINTERS.IP_ADDRESS,
  PRINTERS.PORT,
  PRINTERS.GROUP_ID,
  PRINTERS.[LANGUAGE],
  PRINTERS.PRINTER_DPI,
  LABDATA.PROCESS_ORDER,
  LABDATA.MATERIAL,
  LABDATA.MATERIAL_TYPE,
  MAT.DESCRIPTION AS MATERIAL_DESCRIPTION,
  MAT.SHELF_LIFE_UOM,
  MAT.SHELF_LIFE,
  MAT.SHELF_LIFE_RULE,
  MAT.GROSS_WEIGHT,
  MAT.NET_WEIGHT,
  MAT.WEIGHT_UOM,
  CAST (LABDATA.BASE_QUANTITY *  MAT.GROSS_WEIGHT *
		CASE
			UPPER(LTRIM(RTRIM( MAT.WEIGHT_UOM)))
			WHEN 'G' THEN
				0.001
			WHEN 'KG' THEN
				1.0
			ELSE
				NULL
		END AS DECIMAL (12, 2)
 ) AS TOTAL_GROSS_KG,
 CAST (LABDATA.BASE_QUANTITY *  MAT.NET_WEIGHT *
		CASE
			UPPER(LTRIM(RTRIM( MAT.WEIGHT_UOM)))
			WHEN 'G' THEN
				0.001
			WHEN 'KG' THEN
				1.0
			ELSE
				NULL
		END AS DECIMAL (12, 2)
  ) AS TOTAL_NET_KG,
  LABDATA.BATCH_NUMBER,
  LABDATA.REQUIRED_RESOURCE,
  (SELECT KEY_VALUE FROM dbo.SYS_CONTROL WHERE (SYSTEM_KEY = 'PLANT')) AS PLANT,
  LABDATA.LOCATION_ID,
  LABDATA.DATE_OF_MANUFACTURE,
  LABDATA.EXPIRY_DATE,
  LABDATA.PROD_EAN,
  LABDATA.PROD_VARIANT,
  LABDATA.PROD_QUANTITY,
  LABDATA.PROD_UOM,
  LABDATA.BASE_EAN,
  LABDATA.BASE_VARIANT,
  LABDATA.BASE_QUANTITY,
  LABDATA.BASE_UOM,
  LABDATA.CUSTOMER_ID,
  CUST.CUSTOMER_NAME,
  LABDATA.PRINT_COPIES,
  LABDATA.MODULE_ID,
  LABDATA.OVERRIDE_MANUFACTURE_DATE,
  LABDATA.OVERRIDE_EXPIRY_DATE,
  LABDATA.OVERRIDE_BATCH_PREFIX,
  LABDATA.BATCH_PREFIX,
  LABDATA.BATCH_SUFFIX,
  MOD.REPORT_TYPE,
  MOD.MODULE_TYPE,
  MOD.REPORT_FILENAME,
  CUSTDATA1.DATA AS PART_NO,
  LABDATA.LAYERS,
  CUSTDATA2.DATA AS ALT_TEXT_1
FROM
  dbo.APP_AUTO_LABELLER AS AUTOLAB
  LEFT JOIN dbo.SYS_PRINTER_LINE_MEMBERSHIP AS MEMBER ON AUTOLAB.LINE = MEMBER.LINE   AND AUTOLAB.GROUP_ID = MEMBER.GROUP_ID
  LEFT JOIN dbo.SYS_PRINTERS AS PRINTERS ON MEMBER.PRINTER_ID = PRINTERS.PRINTER_ID AND MEMBER.GROUP_ID = PRINTERS.GROUP_ID
  RIGHT JOIN dbo.APP_LABEL_DATA AS LABDATA ON LABDATA.UNIQUE_ID = AUTOLAB.UNIQUE_ID
  LEFT JOIN dbo.APP_MATERIAL AS MAT ON MAT.MATERIAL = LABDATA.MATERIAL
  LEFT JOIN dbo.APP_CUSTOMER AS CUST ON LABDATA.CUSTOMER_ID = CUST.CUSTOMER_ID
  LEFT JOIN dbo.SYS_MODULES AS MOD ON LABDATA.MODULE_ID = MOD.MODULE_ID
  LEFT JOIN dbo.APP_MATERIAL_CUSTOMER_DATA AS CUSTDATA1 ON LABDATA.MATERIAL = CUSTDATA1.MATERIAL AND LABDATA.CUSTOMER_ID = CUSTDATA1.CUSTOMER_ID AND CUSTDATA1.DATA_ID = 'PART_NO'
  LEFT JOIN dbo.APP_MATERIAL_CUSTOMER_DATA AS CUSTDATA2 ON LABDATA.MATERIAL = CUSTDATA2.MATERIAL AND LABDATA.CUSTOMER_ID = CUSTDATA2.CUSTOMER_ID AND CUSTDATA2.DATA_ID = 'ALT_TEXT_1'
WHERE
  (PRINTERS.ENABLED = 'Y');
  </statement>
	
</DDL>

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE DDL SYSTEM "schema.dtd">
<DDL>

	<statement>
		INSERT INTO [dbo].[SYS_MODULES]([MODULE_ID], [RF_ACTIVE], [DK_ACTIVE], [MODULE_TYPE], [HINT], [MNEMONIC], [ICON_FILENAME], [HELPSET_ID], [REPORT_FILENAME], [EXEC_FILENAME], [EXEC_DIR], [PRINT_PREVIEW], [PRINT_DIALOG], [PRINT_COPIES], [REPORT_TYPE], [RESOURCE_KEY], [AUTO_LABELLER_COMMAND_FILE], [AUTO_LABELLER_LABEL_FILE]) VALUES 
		('FRM_ADMIN_PALLET_IMPORT', 'N', 'Y', 'FUNCTION', 'Import Pallet Data from XML', 0, '', '', '', '', '', 'N', 'N', 0, '', '', NULL, NULL)
	</statement>
	
	<statement>
		INSERT INTO [dbo].[SYS_MODULES]([MODULE_ID], [RF_ACTIVE], [DK_ACTIVE], [MODULE_TYPE], [HINT], [MNEMONIC], [ICON_FILENAME], [HELPSET_ID], [REPORT_FILENAME], [EXEC_FILENAME], [EXEC_DIR], [PRINT_PREVIEW], [PRINT_DIALOG], [PRINT_COPIES], [REPORT_TYPE], [RESOURCE_KEY], [AUTO_LABELLER_COMMAND_FILE], [AUTO_LABELLER_LABEL_FILE]) VALUES 
		('FRM_ADMIN_PALLET_EXPORT', 'N', 'Y', 'FUNCTION', 'Export Pallet Data to XML', 0, '', '', '', '', '', 'N', 'N', 0, '', '', NULL, NULL)
	</statement>

	<statement>	
		INSERT INTO SYS_LANGUAGE(RESOURCE_KEY, LANGUAGE_ID, TEXT, MNEMONIC) VALUES ('btn_Import', 'EN', 'Import', '0')
	</statement>
	
	<statement>	
		INSERT INTO SYS_LANGUAGE(RESOURCE_KEY, LANGUAGE_ID, TEXT, MNEMONIC) VALUES ('btn_Import', 'FR', 'Import', '0')
	</statement>
	
	<statement>	
		INSERT INTO SYS_LANGUAGE(RESOURCE_KEY, LANGUAGE_ID, TEXT, MNEMONIC) VALUES ('btn_Import', 'DE', 'Import', '0')
	</statement>
	
	<statement>	
		INSERT INTO SYS_LANGUAGE(RESOURCE_KEY, LANGUAGE_ID, TEXT, MNEMONIC) VALUES ('btn_Import', 'IT', 'Import', '0')
	</statement>
	
	<statement>	
		INSERT INTO SYS_LANGUAGE(RESOURCE_KEY, LANGUAGE_ID, TEXT, MNEMONIC) VALUES ('btn_Import', 'NL', 'Import', '0')
	</statement>
	
	<statement>	
		INSERT INTO SYS_LANGUAGE(RESOURCE_KEY, LANGUAGE_ID, TEXT, MNEMONIC) VALUES ('btn_Import', 'ES', 'Import', '0')
	</statement>
	
	<statement>	
		INSERT INTO SYS_LANGUAGE(RESOURCE_KEY, LANGUAGE_ID, TEXT, MNEMONIC) VALUES ('btn_Import', 'HU', 'Import', '0')
	</statement>
	
	<statement>	
		INSERT INTO SYS_LANGUAGE(RESOURCE_KEY, LANGUAGE_ID, TEXT, MNEMONIC) VALUES ('btn_Import', 'PL', 'Import', '0')
	</statement>	
	
	<statement>	 
		INSERT INTO SYS_GROUP_PERMISSIONS(GROUP_ID, MODULE_ID) VALUES ('ADMIN', 'FRM_ADMIN_PALLET_EXPORT')
	</statement>
	
	<statement>	 
		INSERT INTO SYS_GROUP_PERMISSIONS(GROUP_ID, MODULE_ID) VALUES ('ADMIN', 'FRM_ADMIN_PALLET_IMPORT')
	</statement>		
	
	<statement>
	    IF OBJECT_ID('VIEW_SYNC1', 'V') IS NOT NULL DROP VIEW VIEW_SYNC1;
	</statement>
	
	<statement>
	    IF OBJECT_ID('VIEW_SYNC2', 'V') IS NOT NULL DROP VIEW VIEW_SYNC2;
	</statement>
	
	<statement>
	    IF OBJECT_ID('VIEW_SYNC3a', 'V') IS NOT NULL DROP VIEW VIEW_SYNC3a;
	</statement>
	
	<statement>
	    IF OBJECT_ID('VIEW_SYNC3b', 'V') IS NOT NULL DROP VIEW VIEW_SYNC3b;
	</statement>
	
	<statement>
	    IF OBJECT_ID('VIEW_SYNC4a', 'V') IS NOT NULL DROP VIEW VIEW_SYNC4a;
	</statement>
	
	<statement>
	    IF OBJECT_ID('VIEW_SYNC4b', 'V') IS NOT NULL DROP VIEW VIEW_SYNC4b;
	</statement>
	
	<statement>		
		CREATE VIEW [dbo].[VIEW_SYNC1] AS SELECT
		[APP_LABEL_DATA].[PRINT_DATE],
		[APP_AUTO_LABELLER].[UNIQUE_ID],
		[APP_AUTO_LABELLER].LINE,
		[APP_AUTO_LABELLER].[GROUP_ID],
		[APP_LABEL_DATA].[PROCESS_ORDER],
		[APP_PROCESS_ORDER].STATUS,
		[APP_LABEL_DATA].MATERIAL,
		[APP_LABEL_DATA].[MATERIAL_TYPE],
		[APP_MATERIAL].DESCRIPTION,
		[APP_MATERIAL].[OLD_MATERIAL],
		[APP_LABEL_DATA].[BATCH_NUMBER],
		[APP_LABEL_DATA].[BATCH_PREFIX],
		[APP_LABEL_DATA].[BATCH_SUFFIX],
		[APP_LABEL_DATA].[REQUIRED_RESOURCE],
		[APP_LABEL_DATA].[DATE_OF_MANUFACTURE],
		[APP_LABEL_DATA].[EXPIRY_DATE],
		[APP_LABEL_DATA].[PROD_EAN],
		[APP_LABEL_DATA].[PROD_VARIANT],
		[APP_LABEL_DATA].[PROD_QUANTITY],
		[APP_LABEL_DATA].[PROD_UOM],
		[APP_LABEL_DATA].[BASE_EAN],
		[APP_LABEL_DATA].[BASE_VARIANT],
		[APP_LABEL_DATA].[BASE_QUANTITY],
		[APP_LABEL_DATA].[BASE_UOM],
		[APP_LABEL_DATA].[CUSTOMER_ID],
		[APP_CUSTOMER].[CUSTOMER_NAME],
		[APP_LABEL_DATA].[LAYERS],
		[APP_MATERIAL].[UPDATED] AS [MATERIAL_UPDATED],
		[APP_PROCESS_ORDER].[UPDATED] AS [PROCESS_ORDER_UPDATED],
		[APP_MATERIAL].[OVERRIDE_PACK_LABEL],
		[APP_MATERIAL].[PACK_LABEL_MODULE_ID],
		[APP_MATERIAL].[OVERRIDE_PALLET_LABEL],
		[APP_MATERIAL].[PALLET_LABEL_MODULE_ID]
		FROM
		[APP_LABEL_DATA]
		JOIN [APP_AUTO_LABELLER]
		ON [APP_LABEL_DATA].[UNIQUE_ID] = [APP_AUTO_LABELLER].[UNIQUE_ID] 
		JOIN [APP_MATERIAL]
		ON [APP_MATERIAL].MATERIAL = [APP_LABEL_DATA].MATERIAL 
		JOIN [APP_PROCESS_ORDER]
		ON [APP_PROCESS_ORDER].[PROCESS_ORDER] = [APP_LABEL_DATA].[PROCESS_ORDER] 
		JOIN [APP_CUSTOMER]
		ON [APP_CUSTOMER].[CUSTOMER_ID] = [APP_LABEL_DATA].[CUSTOMER_ID]
	</statement>

	<statement>	
		CREATE VIEW [dbo].[VIEW_SYNC2] AS SELECT
		[APP_LABEL_DATA].[PRINT_DATE],
		[APP_AUTO_LABELLER].[UNIQUE_ID],
		[APP_AUTO_LABELLER].LINE,
		[APP_AUTO_LABELLER].[GROUP_ID],
		[APP_LABEL_DATA].[PROCESS_ORDER],
		[APP_PROCESS_ORDER].STATUS,
		[APP_LABEL_DATA].MATERIAL,
		[APP_LABEL_DATA].[MATERIAL_TYPE],
		[APP_MATERIAL].DESCRIPTION,
		[APP_MATERIAL].[OLD_MATERIAL],
		[APP_LABEL_DATA].[BATCH_NUMBER],
		[APP_LABEL_DATA].[BATCH_PREFIX],
		[APP_LABEL_DATA].[BATCH_SUFFIX],
		[APP_LABEL_DATA].[REQUIRED_RESOURCE],
		[APP_LABEL_DATA].[DATE_OF_MANUFACTURE],
		[APP_LABEL_DATA].[EXPIRY_DATE],
		[APP_LABEL_DATA].[PROD_EAN],
		[APP_LABEL_DATA].[PROD_VARIANT],
		[APP_LABEL_DATA].[PROD_QUANTITY],
		[APP_LABEL_DATA].[PROD_UOM],
		[APP_LABEL_DATA].[BASE_EAN],
		[APP_LABEL_DATA].[BASE_VARIANT],
		[APP_LABEL_DATA].[BASE_QUANTITY],
		[APP_LABEL_DATA].[BASE_UOM],
		[APP_LABEL_DATA].[CUSTOMER_ID],
		[APP_CUSTOMER].[CUSTOMER_NAME],
		[APP_LABEL_DATA].LAYERS,
		[APP_MATERIAL].UPDATED AS [MATERIAL_UPDATED],
		[APP_PROCESS_ORDER].UPDATED AS [PROCESS_ORDER_UPDATED],
		[APP_MATERIAL].[OVERRIDE_PACK_LABEL],
		[APP_MATERIAL].[PACK_LABEL_MODULE_ID],
		[APP_MATERIAL].[OVERRIDE_PALLET_LABEL],
		[APP_MATERIAL].[PALLET_LABEL_MODULE_ID],
		[SYS_PRINTERS].[PRINTER_ID],
		[SYS_PRINTERS].[PRINTER_TYPE],
		[SYS_PRINTERS].[IP_ADDRESS],
		[SYS_PRINTERS].PORT,
		[SYS_PRINTERS].ENABLED,
		[SYS_PRINTERS].[PRINTER_DPI],
		[SYS_PRINTERS].[PAPER_SIZE]
		FROM
		[APP_LABEL_DATA]
		JOIN [APP_AUTO_LABELLER]
		ON [APP_LABEL_DATA].[UNIQUE_ID] = [APP_AUTO_LABELLER].[UNIQUE_ID] 
		JOIN [APP_MATERIAL]
		ON [APP_MATERIAL].MATERIAL = [APP_LABEL_DATA].MATERIAL 
		JOIN [APP_PROCESS_ORDER]
		ON [APP_PROCESS_ORDER].[PROCESS_ORDER] = [APP_LABEL_DATA].[PROCESS_ORDER] 
		JOIN [APP_CUSTOMER]
		ON [APP_CUSTOMER].[CUSTOMER_ID] = [APP_LABEL_DATA].[CUSTOMER_ID] 
		JOIN [SYS_PRINTER_LINE_MEMBERSHIP]
		ON [APP_AUTO_LABELLER].LINE = [SYS_PRINTER_LINE_MEMBERSHIP].LINE
		AND [APP_AUTO_LABELLER].[GROUP_ID] = [SYS_PRINTER_LINE_MEMBERSHIP].[GROUP_ID] 
		JOIN [SYS_PRINTERS]
		ON [SYS_PRINTER_LINE_MEMBERSHIP].[GROUP_ID] = [SYS_PRINTERS].[GROUP_ID]
		AND [SYS_PRINTER_LINE_MEMBERSHIP].[PRINTER_ID] = [SYS_PRINTERS].[PRINTER_ID]
	</statement>
	
	<statement>
		CREATE VIEW [dbo].[VIEW_SYNC3a] AS SELECT
			[APP_LABEL_DATA].[PROCESS_ORDER] AS [PROCESS_ORDER],
			[APP_LABEL_DATA].MATERIAL AS MATERIAL,
			[APP_LABEL_DATA].[BATCH_NUMBER] AS [BATCH_NUMBER],
			[APP_LABEL_DATA].[LABEL_TYPE] AS [LABEL_TYPE],
			[APP_LABEL_DATA].LINE,
			MAX([APP_LABEL_DATA].[PRINT_DATE]) AS [LAST_PRINT_DATE]
			FROM
			[APP_LABEL_DATA]
			GROUP BY
			[APP_LABEL_DATA].PROCESS_ORDER,[APP_LABEL_DATA].MATERIAL,[APP_LABEL_DATA].BATCH_NUMBER,[APP_LABEL_DATA].LABEL_TYPE,[APP_LABEL_DATA].LINE
	</statement>
	
	<statement>
		CREATE VIEW [dbo].[VIEW_SYNC3b] AS SELECT
			[APP_LABEL_DATA].[UNIQUE_ID],
			[APP_LABEL_DATA].LINE,
			[VIEW_SYNC3a].[LABEL_TYPE],
			[APP_LABEL_DATA].[USER_ID],
			[APP_LABEL_DATA].[WORKSTATION_ID],
			[VIEW_SYNC3a].[PROCESS_ORDER],
			[APP_LABEL_DATA].[REQUIRED_RESOURCE],
			[VIEW_SYNC3a].MATERIAL,
			[APP_LABEL_DATA].[MATERIAL_TYPE],
			[APP_MATERIAL].DESCRIPTION,
			[VIEW_SYNC3a].[BATCH_NUMBER],
			[APP_LABEL_DATA].[BATCH_PREFIX],
			[APP_LABEL_DATA].[BATCH_SUFFIX],
			[APP_PROCESS_ORDER].STATUS,
			[APP_LABEL_DATA].[PRINT_DATE],
			[APP_LABEL_DATA].[PROD_EAN],
			[APP_LABEL_DATA].[PROD_VARIANT],
			[APP_LABEL_DATA].[PROD_QUANTITY],
			[APP_LABEL_DATA].[BASE_EAN],
			[APP_LABEL_DATA].[BASE_VARIANT],
			[APP_LABEL_DATA].[BASE_QUANTITY],
			[APP_LABEL_DATA].[DATE_OF_MANUFACTURE],
			[APP_LABEL_DATA].[EXPIRY_DATE],
			[APP_MATERIAL].UPDATED AS [MATERIAL_UPDATED],
			[APP_PROCESS_ORDER].UPDATED AS [PROCESS_ORDER_UPDATED],
			[APP_PROCESS_ORDER].[CUSTOMER_ID],
			[APP_CUSTOMER].[CUSTOMER_NAME],
			[APP_LABEL_DATA].[OVERRIDE_MANUFACTURE_DATE],
			[APP_LABEL_DATA].[OVERRIDE_EXPIRY_DATE],
			[APP_LABEL_DATA].[OVERRIDE_BATCH_PREFIX],
			[APP_MATERIAL].[OVERRIDE_PACK_LABEL],
			[APP_MATERIAL].[PACK_LABEL_MODULE_ID],
			[APP_MATERIAL].[OVERRIDE_PALLET_LABEL],
			[APP_MATERIAL].[PALLET_LABEL_MODULE_ID],
			[APP_LABEL_DATA].LAYERS
			FROM
			[APP_LABEL_DATA]
			JOIN [VIEW_SYNC3a]
			ON [APP_LABEL_DATA].[PROCESS_ORDER] = [VIEW_SYNC3a].[PROCESS_ORDER]
			AND [APP_LABEL_DATA].MATERIAL = [VIEW_SYNC3a].MATERIAL
			AND [APP_LABEL_DATA].[BATCH_NUMBER] = [VIEW_SYNC3a].[BATCH_NUMBER]
			AND [APP_LABEL_DATA].[PRINT_DATE] = [VIEW_SYNC3a].[LAST_PRINT_DATE]
			AND [APP_LABEL_DATA].[LABEL_TYPE] = [VIEW_SYNC3a].[LABEL_TYPE]
			AND [APP_LABEL_DATA].LINE = [VIEW_SYNC3a].LINE 
			JOIN [APP_PROCESS_ORDER]
			ON [APP_PROCESS_ORDER].[PROCESS_ORDER] = [VIEW_SYNC3a].[PROCESS_ORDER] 
			JOIN [APP_MATERIAL]
			ON [APP_MATERIAL].MATERIAL = [APP_LABEL_DATA].MATERIAL 
			JOIN [APP_CUSTOMER]
			ON [APP_CUSTOMER].[CUSTOMER_ID] = [APP_PROCESS_ORDER].[CUSTOMER_ID]
			WHERE
			[APP_PROCESS_ORDER].STATUS = 'Ready' AND [APP_LABEL_DATA].LINE > ''
	</statement>
	
	<statement>
		CREATE VIEW [dbo].[VIEW_SYNC4a] AS SELECT
			[APP_LABEL_DATA].[PROCESS_ORDER] AS [PROCESS_ORDER],
			[APP_LABEL_DATA].MATERIAL AS MATERIAL,
			[APP_LABEL_DATA].[BATCH_NUMBER] AS [BATCH_NUMBER],
			[APP_LABEL_DATA].[LABEL_TYPE] AS [LABEL_TYPE],
			[APP_LABEL_DATA].LINE,
			[SYS_PRINTERS].[PRINTER_ID],
			MAX ( [APP_LABEL_DATA].[PRINT_DATE] ) AS [LAST_PRINT_DATE]
			FROM
			[SYS_PRINTER_LINE_MEMBERSHIP]
			JOIN [APP_LABEL_DATA]
			ON [SYS_PRINTER_LINE_MEMBERSHIP].LINE = [APP_LABEL_DATA].LINE
			AND [SYS_PRINTER_LINE_MEMBERSHIP].[GROUP_ID] = [APP_LABEL_DATA].[LABEL_TYPE] 
			JOIN [SYS_PRINTERS]
			ON [SYS_PRINTERS].[PRINTER_ID] = [SYS_PRINTER_LINE_MEMBERSHIP].[PRINTER_ID]
			WHERE
			[SYS_PRINTERS].ENABLED = 'Y'
			GROUP BY
			[APP_LABEL_DATA].PROCESS_ORDER,
				[APP_LABEL_DATA].MATERIAL,
				[APP_LABEL_DATA].BATCH_NUMBER,
				[APP_LABEL_DATA].LABEL_TYPE,
				[APP_LABEL_DATA].LINE,
				[SYS_PRINTERS].[PRINTER_ID]	
	</statement>	
	
	<statement>
		CREATE VIEW [dbo].[VIEW_SYNC4b] AS SELECT
			[APP_LABEL_DATA].[UNIQUE_ID],
			[APP_LABEL_DATA].LINE,
			[VIEW_SYNC4a].[LABEL_TYPE],
			[APP_LABEL_DATA].[USER_ID],
			[APP_LABEL_DATA].[WORKSTATION_ID],
			[VIEW_SYNC4a].[PROCESS_ORDER],
			[APP_LABEL_DATA].[REQUIRED_RESOURCE],
			[VIEW_SYNC4a].MATERIAL,
			[APP_LABEL_DATA].[MATERIAL_TYPE],
			[APP_MATERIAL].DESCRIPTION,
			[VIEW_SYNC4a].[BATCH_NUMBER],
			[APP_LABEL_DATA].[BATCH_PREFIX],
			[APP_LABEL_DATA].[BATCH_SUFFIX],
			[APP_PROCESS_ORDER].STATUS,
			[APP_LABEL_DATA].[PRINT_DATE],
			[APP_LABEL_DATA].[PROD_EAN],
			[APP_LABEL_DATA].[PROD_VARIANT],
			[APP_LABEL_DATA].[PROD_QUANTITY],
			[APP_LABEL_DATA].[BASE_EAN],
			[APP_LABEL_DATA].[BASE_VARIANT],
			[APP_LABEL_DATA].[BASE_QUANTITY],
			[APP_LABEL_DATA].[DATE_OF_MANUFACTURE],
			[APP_LABEL_DATA].[EXPIRY_DATE],
			[APP_MATERIAL].UPDATED AS [MATERIAL_UPDATED],
			[APP_PROCESS_ORDER].UPDATED AS [PROCESS_ORDER_UPDATED],
			[APP_PROCESS_ORDER].[CUSTOMER_ID],
			[APP_CUSTOMER].[CUSTOMER_NAME],
			[APP_LABEL_DATA].[OVERRIDE_MANUFACTURE_DATE],
			[APP_LABEL_DATA].[OVERRIDE_EXPIRY_DATE],
			[APP_LABEL_DATA].[OVERRIDE_BATCH_PREFIX],
			[APP_MATERIAL].[OVERRIDE_PACK_LABEL],
			[APP_MATERIAL].[PACK_LABEL_MODULE_ID],
			[APP_MATERIAL].[OVERRIDE_PALLET_LABEL],
			[APP_MATERIAL].[PALLET_LABEL_MODULE_ID],
			[APP_LABEL_DATA].LAYERS,
			[VIEW_SYNC4a].[PRINTER_ID],
			[SYS_PRINTERS].[PRINTER_TYPE],
			[SYS_PRINTERS].[IP_ADDRESS],
			[SYS_PRINTERS].PORT,
			[SYS_PRINTERS].ENABLED,
			[SYS_PRINTERS].[PRINTER_DPI],
			[SYS_PRINTERS].[PAPER_SIZE] 
		FROM
			[APP_LABEL_DATA]
			JOIN [VIEW_SYNC4a] ON [APP_LABEL_DATA].[PROCESS_ORDER] = [VIEW_SYNC4a].[PROCESS_ORDER] 
			AND [APP_LABEL_DATA].MATERIAL = [VIEW_SYNC4a].MATERIAL 
			AND [APP_LABEL_DATA].[BATCH_NUMBER] = [VIEW_SYNC4a].[BATCH_NUMBER] 
			AND [APP_LABEL_DATA].[PRINT_DATE] = [VIEW_SYNC4a].[LAST_PRINT_DATE] 
			AND [APP_LABEL_DATA].[LABEL_TYPE] = [VIEW_SYNC4a].[LABEL_TYPE] 
			AND [APP_LABEL_DATA].LINE = [VIEW_SYNC4a].LINE
			JOIN [APP_PROCESS_ORDER] ON [APP_PROCESS_ORDER].[PROCESS_ORDER] = [VIEW_SYNC4a].[PROCESS_ORDER]
			JOIN [APP_MATERIAL] ON [APP_MATERIAL].MATERIAL = [APP_LABEL_DATA].MATERIAL
			JOIN [APP_CUSTOMER] ON [APP_CUSTOMER].[CUSTOMER_ID] = [APP_PROCESS_ORDER].[CUSTOMER_ID]
			JOIN [SYS_PRINTERS] ON [SYS_PRINTERS].[PRINTER_ID] = [VIEW_SYNC4a].[PRINTER_ID] 
		WHERE
			[APP_PROCESS_ORDER].STATUS = 'Ready' 
			AND [APP_LABEL_DATA].LINE > ''
	</statement>	
	
</DDL>
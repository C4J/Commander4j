<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE DDL SYSTEM "schema.dtd">
<DDL>

<statement>
CREATE INDEX PH_SSCC_NDX ON APP_PALLET_HISTORY (SSCC, TRANSACTION_DATE)
</statement>

<statement>
	ALTER TABLE APP_PALLET ADD DATE_CREATED DATE DEFAULT NULL
</statement>

<statement>
	ALTER TABLE APP_PALLET ADD CREATED_BY_USER_ID VARCHAR2(20) DEFAULT NULL
</statement>

<statement>
	ALTER TABLE APP_PALLET ADD DATE_UPDATED DATE DEFAULT NULL
</statement>

<statement>
	ALTER TABLE APP_PALLET ADD UPDATED_BY_USER_ID VARCHAR2(20) DEFAULT NULL
</statement>

<statement>
	UPDATE APP_PALLET SET DATE_CREATED = (SELECT MIN(TRANSACTION_DATE) FROM APP_PALLET_HISTORY WHERE SSCC = APP_PALLET.SSCC)
</statement>

<statement>
	UPDATE APP_PALLET SET DATE_UPDATED = (SELECT MAX(TRANSACTION_DATE) FROM APP_PALLET_HISTORY WHERE SSCC = APP_PALLET.SSCC)
</statement>

<statement>
	UPDATE APP_PALLET T1 SET CREATED_BY_USER_ID = 
	(SELECT USER_ID FROM APP_PALLET_HISTORY T2 
	WHERE T2.SSCC = T1.SSCC AND TRANSACTION_REF = 
	(SELECT MIN(TRANSACTION_REF) 
	FROM APP_PALLET_HISTORY T2 WHERE T2.SSCC = T1.SSCC) AND ROWNUM = 1)
</statement>

<statement>
	UPDATE APP_PALLET T1 SET UPDATED_BY_USER_ID = 
	(SELECT USER_ID FROM APP_PALLET_HISTORY T2 
	WHERE T2.SSCC = T1.SSCC AND TRANSACTION_REF = 
	(SELECT MAX(TRANSACTION_REF) 
	FROM APP_PALLET_HISTORY T2 WHERE T2.SSCC = T1.SSCC) AND ROWNUM = 1)
</statement>


<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Created_By', 'EN', 'Created By', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Created_By', 'NL', 'Gemaakt door', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Created_By', 'HU', 'Létrehozta', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Created_By', 'IT', 'Creato da', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Date_Created', 'EN', 'Date Created', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Date_Created', 'NL', 'Aanmaakdatum', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Date_Created', 'HU', 'Létrehozás dátuma', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Date_Created', 'IT', 'Data di creazione', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Updated_By', 'EN', 'Updated By', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Updated_By', 'NL', 'bijgewerkt door', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Updated_By', 'HU', 'Módosította', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Updated_By', 'IT', 'Aggiornato da', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Date_Updated', 'EN', 'Date Updated', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Date_Updated', 'NL', 'Datum bijgewerkt', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Date_Updated', 'HU', 'Frissítés dátuma', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Date_Updated', 'IT', 'Data aggiornamento', 'Q')
</statement>

<statement>
  CREATE OR REPLACE FORCE VIEW view_pallet_expiry 
  ("SSCC", "LOCATION_ID", "MATERIAL", "BATCH_NUMBER", "PROCESS_ORDER", "QUANTITY", "UOM", "DATE_OF_MANUFACTURE", "STATUS", "EAN", "VARIANT", "DESPATCH_NO", "CONFIRMED", "LAYERS", "SSCC_EXPIRY_DATE", "CUSTOMER_ID", "MHN_NUMBER", "DECISION", "EXPIRY_DATE", "DESCRIPTION", "OLD_MATERIAL", "CUSTOMER_NAME", "PRINT_ON_LABEL","DATE_CREATED","CREATED_BY_USER_ID","DATE_UPDATED","UPDATED_BY_USER_ID") AS 
  (SELECT P."SSCC",
  P."LOCATION_ID",
  P."MATERIAL",
  P."BATCH_NUMBER",
  P."PROCESS_ORDER",
  P."QUANTITY",
  P."UOM",
  P."DATE_OF_MANUFACTURE",
  P."STATUS",
  P."EAN",
  P."VARIANT",
  P."DESPATCH_NO",
  P."CONFIRMED",
  P."LAYERS",
  P."SSCC_EXPIRY_DATE",
  P."CUSTOMER_ID",
  P."MHN_NUMBER",
  P."DECISION",
  B.EXPIRY_DATE,
  M.DESCRIPTION,
  M.OLD_MATERIAL,
  C.CUSTOMER_NAME,
  C.PRINT_ON_LABEL,
  p.DATE_CREATED,
  P.CREATED_BY_USER_ID,
  P.DATE_UPDATED,
  P.UPDATED_BY_USER_ID FROM 
      APP_PALLET P, APP_MATERIAL_BATCH B, 
      APP_MATERIAL M,APP_CUSTOMER C 
      WHERE B.MATERIAL = P.MATERIAL AND 
      B.BATCH_NUMBER = P.BATCH_NUMBER AND 
      M.MATERIAL = P.MATERIAL AND 
      C.CUSTOMER_ID = P.CUSTOMER_ID)
</statement>

<statement>
	INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Deleted', 'EN', 'Deleted', 'Q')
</statement>

<statement>
	INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Deleted', 'NL', 'Verwijderde', 'Q')
</statement>

<statement>
	INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Deleted', 'HU', 'Törölt', 'Q')
</statement>

<statement>
	INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Deleted', 'IT', 'Soppresso', 'Q')
</statement>

<statement>
INSERT INTO SYS_MODULES (MODULE_ID,RF_ACTIVE,DK_ACTIVE,MODULE_TYPE,HINT,MNEMONIC,ICON_FILENAME,HELPSET_ID,REPORT_FILENAME,EXEC_FILENAME,EXEC_DIR,PRINT_PREVIEW,PRINT_DIALOG,PRINT_COPIES,REPORT_TYPE,RESOURCE_KEY) VALUES
('FRM_PAL_DELETE', 'Y', 'N', 'FORM', 'Delete Pallet', '77', 'split.gif', '', '', '', '', 'Y', 'N', '1', '', 'mod_FRM_ADMIN_PALLET_DELETE')
</statement>

<statement>
INSERT INTO SYS_RF_MENU (MODULE_ID,SEQUENCE_ID) VALUES ('FRM_PAL_DELETE','3')
</statement>

<statement>
INSERT INTO SYS_GROUP_PERMISSIONS (GROUP_ID,MODULE_ID) VALUES ('ADMIN', 'FRM_PAL_DELETE')
</statement>

<statement>
	alter table APP_LOCATION add MSG_PALLET_DELETE varchar(1) default 'N'
</statement>

</DDL>
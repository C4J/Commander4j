<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE DDL SYSTEM "schema.dtd">
<DDL>

	<statement>
		ALTER TABLE APP_AUTO_LABELLER ADD (PREFIX_CODE VARCHAR2(4) DEFAULT '' )
	</statement>

	<statement>
		UPDATE APP_AUTO_LABELLER SET PREFIX_CODE = ''
	</statement>
	
	<statement>	
		INSERT INTO SYS_LANGUAGE (RESOURCE_KEY, LANGUAGE_ID, TEXT, MNEMONIC) VALUES ('lbl_Prefix_Code', 'EN', 'Prefix Code', '0')
	</statement>
	
	<statement>	
		INSERT INTO SYS_LANGUAGE (RESOURCE_KEY, LANGUAGE_ID, TEXT, MNEMONIC) VALUES ('lbl_Prefix_Code', 'FR', 'Code de préfixe', '0')
	</statement>
	
	<statement>	
		INSERT INTO SYS_LANGUAGE (RESOURCE_KEY, LANGUAGE_ID, TEXT, MNEMONIC) VALUES ('lbl_Prefix_Code', 'DE', 'Präfix-Code', '0')
	</statement>
	
	<statement>	
		INSERT INTO SYS_LANGUAGE (RESOURCE_KEY, LANGUAGE_ID, TEXT, MNEMONIC) VALUES ('lbl_Prefix_Code', 'HU', 'Előtagkód', '0')
	</statement>
	
	<statement>	
		INSERT INTO SYS_LANGUAGE (RESOURCE_KEY, LANGUAGE_ID, TEXT, MNEMONIC) VALUES ('lbl_Prefix_Code', 'PL', 'Kod prefiksu', '0')
	</statement>
	
	<statement>	
		INSERT INTO SYS_LANGUAGE (RESOURCE_KEY, LANGUAGE_ID, TEXT, MNEMONIC) VALUES ('lbl_Prefix_Code', 'IT', 'Prefisso', '0')
	</statement>
	
	<statement>	
		INSERT INTO SYS_LANGUAGE (RESOURCE_KEY, LANGUAGE_ID, TEXT, MNEMONIC) VALUES ('lbl_Prefix_Code', 'NL', 'Prefixcode', '0')
	</statement>
	
	<statement>	
		INSERT INTO SYS_LANGUAGE (RESOURCE_KEY, LANGUAGE_ID, TEXT, MNEMONIC) VALUES ('lbl_Prefix_Code', 'SP', 'Código de prefijo', '0')
	</statement>
	
	<statement>
		CREATE OR REPLACE VIEW view_sync4b AS SELECT
				APP_LABEL_DATA.UNIQUE_ID,
				APP_LABEL_DATA.LINE,
				view_sync4a.LABEL_TYPE,
				APP_AUTO_LABELLER.PREFIX_CODE,
				APP_LABEL_DATA.USER_ID,
				APP_LABEL_DATA.WORKSTATION_ID,
				view_sync4a.PROCESS_ORDER,
				APP_LABEL_DATA.REQUIRED_RESOURCE,
				view_sync4a.MATERIAL,
				APP_LABEL_DATA.MATERIAL_TYPE,
				APP_MATERIAL.DESCRIPTION,
				view_sync4a.BATCH_NUMBER,
				APP_LABEL_DATA.BATCH_PREFIX,
				APP_LABEL_DATA.BATCH_SUFFIX,
				APP_PROCESS_ORDER.STATUS,
				APP_PROCESS_ORDER.REQUIRED_UOM,
				APP_LABEL_DATA.PRINT_DATE,
				APP_LABEL_DATA.PROD_EAN,
				APP_LABEL_DATA.PROD_VARIANT,
				APP_LABEL_DATA.PROD_QUANTITY,
				APP_LABEL_DATA.BASE_EAN,
				APP_LABEL_DATA.BASE_VARIANT,
				APP_LABEL_DATA.BASE_QUANTITY,
				APP_LABEL_DATA.DATE_OF_MANUFACTURE,
				APP_LABEL_DATA.EXPIRY_DATE,
				APP_MATERIAL.UPDATED AS MATERIAL_UPDATED,
				APP_PROCESS_ORDER.UPDATED AS PROCESS_ORDER_UPDATED,
				APP_PROCESS_ORDER.CUSTOMER_ID,
				APP_CUSTOMER.CUSTOMER_NAME,
				APP_LABEL_DATA.OVERRIDE_MANUFACTURE_DATE,
				APP_LABEL_DATA.OVERRIDE_EXPIRY_DATE,
				APP_LABEL_DATA.OVERRIDE_BATCH_PREFIX,
				APP_MATERIAL.OVERRIDE_PACK_LABEL,
				APP_MATERIAL.PACK_LABEL_MODULE_ID,
				APP_MATERIAL.OVERRIDE_PALLET_LABEL,
				APP_MATERIAL.PALLET_LABEL_MODULE_ID,
				APP_LABEL_DATA.LAYERS,
				view_sync4a.PRINTER_ID,
				SYS_PRINTERS.PRINTER_TYPE,
				SYS_PRINTERS.IP_ADDRESS,
				SYS_PRINTERS.PORT,
				SYS_PRINTERS.ENABLED,
				SYS_PRINTERS.PRINTER_DPI,
				SYS_PRINTERS.PAPER_SIZE 
			FROM
				APP_LABEL_DATA
				JOIN view_sync4a ON APP_LABEL_DATA.PROCESS_ORDER = view_sync4a.PROCESS_ORDER 
				AND APP_LABEL_DATA.MATERIAL = view_sync4a.MATERIAL 
				AND APP_LABEL_DATA.BATCH_NUMBER = view_sync4a.BATCH_NUMBER 
				AND APP_LABEL_DATA.LABEL_TYPE = view_sync4a.LABEL_TYPE 
				AND APP_LABEL_DATA.LINE = view_sync4a.LINE 
				AND APP_LABEL_DATA.PRINT_DATE = view_sync4a.LAST_PRINT_DATE
				JOIN APP_PROCESS_ORDER ON APP_PROCESS_ORDER.PROCESS_ORDER = view_sync4a.PROCESS_ORDER
				JOIN APP_MATERIAL ON APP_MATERIAL.MATERIAL = APP_LABEL_DATA.MATERIAL
				JOIN APP_AUTO_LABELLER ON APP_AUTO_LABELLER.LINE = view_sync4a.LINE AND APP_AUTO_LABELLER.GROUP_ID = view_sync4a.LABEL_TYPE
				JOIN APP_CUSTOMER ON APP_CUSTOMER.CUSTOMER_ID = APP_PROCESS_ORDER.CUSTOMER_ID
				JOIN SYS_PRINTERS ON SYS_PRINTERS.PRINTER_ID = view_sync4a.PRINTER_ID 
			WHERE
				APP_PROCESS_ORDER.STATUS = 'Ready' AND APP_LABEL_DATA.LINE IS NOT NULL
	</statement>

	<statement>
		UPDATE SYS_LANGUAGE SET TEXT = 'Change Password' WHERE  RESOURCE_KEY = 'web_Change_Password' AND LANGUAGE_ID = 'EN'
	</statement>


</DDL>

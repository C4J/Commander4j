<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE DDL SYSTEM "schema.dtd">
<DDL>


	<statement>COMMIT</statement>
    <statement>
		ALTER TABLE APP_PALLET_SAMPLES RENAME COLUMN "COMMENT" TO "SAMPLE_COMMENT"
    </statement>
    
        <statement>     
		CREATE OR REPLACE VIEW view_pallet_samples AS SELECT
			app_pallet_samples.SSCC AS SSCC,
			app_pallet_samples.SAMPLE_SEQUENCE AS SAMPLE_SEQUENCE,
			app_pallet_samples.SAMPLE_DATE AS SAMPLE_DATE,
			app_pallet_samples.SAMPLE_REASON AS SAMPLE_REASON,
			app_pallet_samples.DEFECT_TYPE AS DEFECT_TYPE,
			app_pallet_samples.DEFECT_ID AS DEFECT_ID,
			app_pallet_samples.LEAKING AS LEAKING,
			app_pallet_samples."SAMPLE_COMMENT" AS "SAMPLE_COMMENT",
			app_pallet_extension.PALLET_QUANTITY AS START_QUANTITY,
			app_pallet_samples.SAMPLE_QUANTITY AS SAMPLE_QUANTITY,
			app_pallet_samples.SAMPLE_POINT AS SAMPLE_POINT,
			app_pallet_extension.FIRST_CASE_INPUT AS FIRST_CASE_INPUT,
			app_pallet_extension.FIRST_CASE_TIME AS FIRST_CASE_TIME,
			app_pallet_extension.LAST_CASE_INPUT AS LAST_CASE_INPUT,
			app_pallet_extension.LAST_CASE_TIME AS LAST_CASE_TIME,
			app_pallet_extension.SHIFT_ID AS SHIFT_ID,
			app_pallet_extension.SUPPLIER_ID1 AS SUPPLIER_ID1,
			app_pallet_extension.INCIDENT_REFERENCE AS INCIDENT_REFERENCE,
			app_pallet_extension.LOCATION AS LOCATION,
			app_pallet_extension.PRODUCT_GROUP AS PRODUCT_GROUP,
			app_pallet_extension.CONTAINER_CODE AS CONTAINER_CODE,
			app_pallet_extension.PWEEK AS PWEEK,
			app_pallet_extension.PDAY AS PDAY,
			app_pallet_extension.PMONTH AS PMONTH,
			app_pallet_extension.PYEAR AS PYEAR,
			app_supplier.SUPPLIER_TYPE AS SUPPLIER_TYPE,
			app_supplier.DESCRIPTION AS SUPPLIER_DESCRIPTION,
			app_pallet.LOCATION_ID AS LOCATION_ID,
			app_pallet.MATERIAL AS MATERIAL,
			app_pallet.BATCH_NUMBER AS BATCH_NUMBER,
			app_pallet.PROCESS_ORDER AS PROCESS_ORDER,
			app_pallet.DATE_OF_MANUFACTURE AS DATE_OF_MANUFACTURE,
			app_pallet.STATUS AS PALLET_STATUS,
			app_pallet.MHN_NUMBER AS MHN_NUMBER,
			app_pallet.DECISION AS DECISION,
			app_sample_defect_type.DESCRIPTION AS DEFECT_TYPE_DESCRIPTION,
			app_sample_defect_type.NON_LEAKING_DATA AS NON_LEAKING_DATA,
	    app_sample_defect_type.LEAKING_DATA AS LEAKING_DATA,
			app_sample_defect_id.DESCRIPTION AS DEFECT_ID_DESCRIPTION 
		FROM
			app_pallet_samples
			JOIN app_pallet_extension ON  app_pallet_samples.SSCC = app_pallet_extension.SSCC 
			JOIN app_supplier ON app_pallet_extension.SUPPLIER_ID1 = app_supplier.SUPPLIER_ID 
			JOIN app_sample_defect_id ON app_pallet_samples.DEFECT_ID = app_sample_defect_id.DEFECT_ID
			JOIN app_sample_defect_type ON app_pallet_samples.DEFECT_TYPE = app_sample_defect_type.DEFECT_TYPE
			JOIN app_pallet ON app_pallet_samples.SSCC = app_pallet.SSCC
    </statement>
        
    <statement>
		CREATE OR REPLACE VIEW VIEW_SORTING_QTY_DIFFS AS SELECT
			APP_PALLET_EXTENSION.SSCC, 
			APP_PALLET_EXTENSION.PALLET_QUANTITY, 
			APP_PALLET.QUANTITY, 
			APP_PALLET.DATE_OF_MANUFACTURE, 
			APP_PALLET.MATERIAL,
			APP_PALLET.BATCH_NUMBER,
			APP_PALLET.STATUS,
			APP_PALLET.MHN_NUMBER,
			APP_PALLET.DECISION,
			APP_MATERIAL_BATCH.STATUS AS BATCH_STATUS,
		  TO_CHAR(MAX(SAMPLE_DATE),'DD/MM/YY HH24:MI:SS') AS SAMPLE_DATE
		FROM
			APP_PALLET_EXTENSION
			LEFT JOIN
			APP_PALLET
			ON 
				APP_PALLET_EXTENSION.SSCC = APP_PALLET.SSCC
			LEFT JOIN
			APP_MATERIAL_BATCH
			ON 
				APP_PALLET.MATERIAL = APP_MATERIAL_BATCH.MATERIAL
				AND
				APP_PALLET.BATCH_NUMBER = APP_MATERIAL_BATCH.BATCH_NUMBER
			LEFT JOIN
			   APP_PALLET_SAMPLES 
			 ON APP_PALLET.SSCC = APP_PALLET_SAMPLES.SSCC
		WHERE
			APP_PALLET_EXTENSION.PALLET_QUANTITY &lt;&gt; APP_PALLET.QUANTITY
			GROUP BY 	APP_PALLET_EXTENSION.SSCC, 
			APP_PALLET_EXTENSION.PALLET_QUANTITY, 
			APP_PALLET.QUANTITY, 
			APP_PALLET.DATE_OF_MANUFACTURE, 
			APP_PALLET.MATERIAL,
			APP_PALLET.BATCH_NUMBER,
			APP_PALLET.STATUS,
			APP_PALLET.MHN_NUMBER,
			APP_PALLET.DECISION,
			APP_MATERIAL_BATCH.STATUS
    </statement>

</DDL>

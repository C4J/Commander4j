<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE DDL SYSTEM "schema.dtd">
<DDL>

<statement>
	ALTER TABLE `APP_CUSTOMER` ADD COLUMN `UPDATED` DATETIME  DEFAULT NULL;
</statement>

<statement>
	UPDATE APP_CUSTOMER SET UPDATED = CURDATE();
</statement>

<statement>
	ALTER TABLE `APP_CUSTOMER` ADD COLUMN `CUSTOMER_DATA_01` VARCHAR(40)  DEFAULT '';
</statement>

<statement>
	ALTER TABLE `APP_CUSTOMER` ADD COLUMN `CUSTOMER_DATA_02` VARCHAR(40)  DEFAULT '';
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Customer_Data_01', 'EN', 'Customer Data 1', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Customer_Data_01', 'NL', 'Customer Data 1', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Customer_Data_01', 'HU', 'Customer Data 1', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Customer_Data_01', 'IT', 'Customer Data 1', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Customer_Data_01', 'DE', 'Customer Data 1', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Customer_Data_01', 'ES', 'Customer Data 1', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Customer_Data_01', 'PL', 'Customer Data 1', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Customer_Data_02', 'EN', 'Customer Data 2', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Customer_Data_02', 'NL', 'Customer Data 2', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Customer_Data_02', 'HU', 'Customer Data 2', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Customer_Data_02', 'IT', 'Customer Data 2', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Customer_Data_02', 'DE', 'Customer Data 2', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Customer_Data_02', 'ES', 'Customer Data 2', 'Q')
</statement>

<statement>
INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('lbl_Customer_Data_02', 'PL', 'Customer Data 2', 'Q')
</statement>

<statement>
	DROP VIEW VIEW_LABEL_DATA_PROCESS_ORDER
</statement>

<statement>
	CREATE VIEW VIEW_LABEL_DATA_PROCESS_ORDER
		AS
		SELECT        PO.PROCESS_ORDER, PO.STATUS, PO.MATERIAL, PO.REQUIRED_UOM, PO.REQUIRED_RESOURCE, PO.DUE_DATE, MAT.MATERIAL_TYPE, MAT.DESCRIPTION, 
		                         RIGHT('00000000000000' + MATUOM_PROD.EAN, 14) AS PROD_EAN, RIGHT('00' + MATUOM_PROD.VARIANT, 2) AS PROD_VARIANT, 
		                         MATUOM_BASE.NUMERATOR AS PROD_QUANTITY, RIGHT('00000000000000' + MATUOM_BASE.EAN, 14) AS BASE_EAN, RIGHT('00' + MATUOM_BASE.VARIANT, 2) 
		                         AS BASE_VARIANT, MATUOM_PROD.NUMERATOR AS BASE_QUANTITY, c4j_GetFullPalletQuantity(PO.PROCESS_ORDER) AS PALLET_QUANTITY, 
		                         c4j_GetLayers(PO.PROCESS_ORDER) AS PALLET_LAYERS, MAT.OLD_MATERIAL, MAT.SHELF_LIFE, MAT.SHELF_LIFE_UOM, MAT.SHELF_LIFE_RULE, 
		                         PO.CUSTOMER_ID, CUST.CUSTOMER_NAME, c4j_GetFinalBatchNumber(CURDATE(), 'N', '', '', PO.PROCESS_ORDER) AS BATCH_NUMBER, 
		                         c4j_GetFinalExpiryDate(CURDATE(), MAT.SHELF_LIFE, MAT.SHELF_LIFE_UOM, MAT.SHELF_LIFE_RULE, 'N', CURDATE()) AS EXPIRY_DATE, 
		                         MAT.UPDATED AS MATERIAL_UPDATED, PO.UPDATED AS PROCESS_ORDER_UPDATED, APP_MATERIAL_CUSTOMER_DATA.DATA AS PART_NO,
		                         IFNULL(CUST.CUSTOMER_DATA_01,'') AS CASE__LABEL,IFNULL(CUST.CUSTOMER_DATA_02,'') AS PALLET__LABEL,CUST.UPDATED AS CUSTOMER_UPDATED
		FROM            APP_PROCESS_ORDER AS PO INNER JOIN
		                         APP_MATERIAL AS MAT ON MAT.MATERIAL = PO.MATERIAL INNER JOIN
		                         APP_CUSTOMER AS CUST ON CUST.CUSTOMER_ID = PO.CUSTOMER_ID INNER JOIN
		                         APP_MATERIAL_UOM AS MATUOM_PROD ON MATUOM_PROD.MATERIAL = PO.MATERIAL AND MATUOM_PROD.UOM = PO.REQUIRED_UOM INNER JOIN
		                         APP_MATERIAL_UOM AS MATUOM_BASE ON MATUOM_BASE.MATERIAL = PO.MATERIAL AND MATUOM_BASE.UOM = MAT.BASE_UOM AND 
		                         MATUOM_BASE.UOM = MAT.BASE_UOM LEFT OUTER JOIN
		                         APP_MATERIAL_CUSTOMER_DATA ON PO.MATERIAL = APP_MATERIAL_CUSTOMER_DATA.MATERIAL AND 
		                         PO.CUSTOMER_ID = APP_MATERIAL_CUSTOMER_DATA.CUSTOMER_ID AND APP_MATERIAL_CUSTOMER_DATA.DATA_ID = 'PART_NO'	
</statement>

</DDL>
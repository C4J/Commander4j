<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE DDL SYSTEM "schema.dtd">
<DDL>

<statement>
	CREATE TABLE [dbo].[SYS_MODULES_ALTERNATIVE](
		[MODULE_ID] [nvarchar](35) NOT NULL,
		[WORKSTATION_ID] [nvarchar](40) NOT NULL,
		[ALT_MODULE_ID] [nvarchar](35) NULL,
	 CONSTRAINT [PK_SYS_MODULES_ALTERNATIVE] PRIMARY KEY CLUSTERED 
	(
		[MODULE_ID] ASC,
		[WORKSTATION_ID] ASC
	)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
	) ON [PRIMARY]  
</statement>

<statement> 
	INSERT INTO SYS_MODULES (MODULE_ID, RF_ACTIVE, DK_ACTIVE, MODULE_TYPE, HINT, MNEMONIC, ICON_FILENAME, HELPSET_ID, REPORT_FILENAME, EXEC_FILENAME, EXEC_DIR, PRINT_PREVIEW, PRINT_DIALOG, PRINT_COPIES, REPORT_TYPE, RESOURCE_KEY) VALUES ('FRM_ADMIN_MODULE_ALTERNATE', 'N', 'Y', 'FORM', 'btn_Alternative', '0', 'alternative.gif', '', '', '', '', 'N', 'N', '1', '', 'mod_FRM_ADMIN_MODULE_GROUPS')
</statement> 	
	
<statement>
	INSERT INTO SYS_GROUP_PERMISSIONS (GROUP_ID, MODULE_ID) VALUES ('ADMIN', 'FRM_ADMIN_MODULE_ALTERNATE')
</statement>

<statement> 
	INSERT INTO SYS_MODULES (MODULE_ID, RF_ACTIVE, DK_ACTIVE, MODULE_TYPE, HINT, MNEMONIC, ICON_FILENAME, HELPSET_ID, REPORT_FILENAME, EXEC_FILENAME, EXEC_DIR, PRINT_PREVIEW, PRINT_DIALOG, PRINT_COPIES, REPORT_TYPE, RESOURCE_KEY) VALUES ('FRM_ADMIN_MODULE_COPY', 'N', 'Y', 'FUNCTION', NULL, 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 'btn_Copy')
</statement> 	
	
<statement>
	INSERT INTO SYS_GROUP_PERMISSIONS (GROUP_ID, MODULE_ID) VALUES ('ADMIN', 'FRM_ADMIN_MODULE_COPY')
</statement>

<statement>
	DELETE FROM SYS_ARCHIVE WHERE ARCHIVE_ID = 'INT_LOG'
</statement>

<statement>
	INSERT INTO SYS_ARCHIVE (ARCHIVE_ID,DESCRIPTION,ENABLED,BACKGROUND_TASK,RETENTION_DAYS,SQL_TABLE,SQL_CRITERIA,SEQUENCE) VALUES 
	                        ('INT_LOG','System Interface Log','Y','Y',30,'SYS_INTERFACE_LOG','EVENT_TIME &lt; ?',10)
</statement>

<statement>
	DELETE FROM SYS_ARCHIVE WHERE ARCHIVE_ID = 'JOURNEY_REF'
</statement>

<statement>
	INSERT INTO SYS_ARCHIVE (ARCHIVE_ID,DESCRIPTION,ENABLED,BACKGROUND_TASK,RETENTION_DAYS,SQL_TABLE,SQL_CRITERIA,SEQUENCE) VALUES 
	                        ('JOURNEY_REF','Journey Refs','Y','Y',2,'APP_JOURNEY','STATUS = ''Unassigned'' AND TIMESLOT &lt; ?',20)
</statement>

<statement>
	sp_RENAME 'SYS_MODULES.[resource_key]' , 'RESOURCE_KEY', 'COLUMN'
</statement>

<statement>
	create view view_permissions as 
	SELECT
	dbo.[SYS_USERS].[USER_ID],
	dbo.[SYS_USERS].[USER_COMMENT],
	dbo.[SYS_GROUPS].[GROUP_ID],
	dbo.[SYS_GROUPS].DESCRIPTION,
	dbo.[SYS_MODULES].[MODULE_ID],
	dbo.[SYS_MODULES].[MODULE_TYPE],
	dbo.[SYS_LANGUAGE].[TEXT],
	dbo.[SYS_MODULES].[DK_ACTIVE],
	dbo.[SYS_MODULES].[RF_ACTIVE]
	FROM
	dbo.[SYS_USER_GROUP_MEMBERSHIP]
	RIGHT JOIN dbo.[SYS_USERS]
	ON dbo.[SYS_USER_GROUP_MEMBERSHIP].[USER_ID] = dbo.[SYS_USERS].[USER_ID] 
	RIGHT JOIN dbo.[SYS_GROUPS]
	ON dbo.[SYS_GROUPS].[GROUP_ID] = dbo.[SYS_USER_GROUP_MEMBERSHIP].[GROUP_ID] 
	LEFT JOIN dbo.[SYS_GROUP_PERMISSIONS]
	ON dbo.[SYS_GROUP_PERMISSIONS].[GROUP_ID] = dbo.[SYS_GROUPS].[GROUP_ID] 
	LEFT JOIN dbo.[SYS_MODULES]
	ON dbo.[SYS_MODULES].[MODULE_ID] = dbo.[SYS_GROUP_PERMISSIONS].[MODULE_ID] 
	LEFT JOIN dbo.[SYS_LANGUAGE]
	ON dbo.[SYS_LANGUAGE].[RESOURCE_KEY] = dbo.[SYS_MODULES].[resource_key]
	AND dbo.[SYS_LANGUAGE].[LANGUAGE_ID] = dbo.[SYS_USERS].[LANGUAGE_ID]
	WHERE
	ACCOUNT_ENABLED = 'Y' AND (ACCOUNT_EXPIRES = 'N' OR (ACCOUNT_EXPIRES = 'Y' AND ACCOUNT_EXPIRY_DATE > GETDATE()))
</statement>

<statement>
	INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('btn_TestHelp', 'EN', 'Show Help', '')
</statement>

<statement>
	INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('btn_Export', 'EN', 'Export', '')
</statement>

<statement>
		INSERT INTO SYS_LANGUAGE (RESOURCE_KEY,LANGUAGE_ID,TEXT,MNEMONIC) VALUES ('btn_Alternative','EN','Alternative','')
</statement>

<statement> 
	INSERT INTO SYS_MODULES (MODULE_ID, RF_ACTIVE, DK_ACTIVE, MODULE_TYPE, HINT, MNEMONIC, ICON_FILENAME, HELPSET_ID, REPORT_FILENAME, EXEC_FILENAME, EXEC_DIR, PRINT_PREVIEW, PRINT_DIALOG, PRINT_COPIES, REPORT_TYPE, RESOURCE_KEY) VALUES ('FRM_ADMIN_USER_PERM_EXPORT', 'N', 'Y', 'FUNCTION', NULL, 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 'btn_Export')
</statement> 	
	
<statement>
	INSERT INTO SYS_GROUP_PERMISSIONS (GROUP_ID, MODULE_ID) VALUES ('ADMIN', 'FRM_ADMIN_USER_PERM_EXPORT')
</statement>

</DDL>
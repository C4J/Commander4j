<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE DDL SYSTEM "schema.dtd">
<DDL>

    <statement>
		ALTER TABLE APP_PALLET_SAMPLES RENAME COLUMN COMMENT TO SAMPLE_COMMENT;
    </statement>
    
    <statement>     
		CREATE OR REPLACE VIEW `view_pallet_samples` AS SELECT
			`APP_PALLET_SAMPLES`.`SSCC` AS `SSCC`,
			`APP_PALLET_SAMPLES`.`SAMPLE_SEQUENCE` AS `SAMPLE_SEQUENCE`,
			`APP_PALLET_SAMPLES`.`SAMPLE_DATE` AS `SAMPLE_DATE`,
			`APP_PALLET_SAMPLES`.`SAMPLE_REASON` AS `SAMPLE_REASON`,
			`APP_PALLET_SAMPLES`.`DEFECT_TYPE` AS `DEFECT_TYPE`,
			`APP_PALLET_SAMPLES`.`DEFECT_ID` AS `DEFECT_ID`,
			`APP_PALLET_SAMPLES`.`LEAKING` AS `LEAKING`,
			`APP_PALLET_SAMPLES`.`SAMPLE_COMMENT` AS `SAMPLE_COMMENT`,
			`APP_PALLET_EXTENSION`.`PALLET_QUANTITY` AS `START_QUANTITY`,
			`APP_PALLET_SAMPLES`.`SAMPLE_QUANTITY` AS `SAMPLE_QUANTITY`,
			`APP_PALLET_SAMPLES`.`SAMPLE_POINT` AS `SAMPLE_POINT`,
			`APP_PALLET_EXTENSION`.`FIRST_CASE_INPUT` AS `FIRST_CASE_INPUT`,
			`APP_PALLET_EXTENSION`.`FIRST_CASE_TIME` AS `FIRST_CASE_TIME`,
			`APP_PALLET_EXTENSION`.`LAST_CASE_INPUT` AS `LAST_CASE_INPUT`,
			`APP_PALLET_EXTENSION`.`LAST_CASE_TIME` AS `LAST_CASE_TIME`,
			`APP_PALLET_EXTENSION`.`SHIFT_ID` AS `SHIFT_ID`,
			`APP_PALLET_EXTENSION`.`SUPPLIER_ID1` AS `SUPPLIER_ID1`,
			`APP_PALLET_EXTENSION`.`INCIDENT_REFERENCE` AS `INCIDENT_REFERENCE`,
			`APP_PALLET_EXTENSION`.`LOCATION` AS `LOCATION`,
			`APP_PALLET_EXTENSION`.`PRODUCT_GROUP` AS `PRODUCT_GROUP`,
			`APP_PALLET_EXTENSION`.`CONTAINER_CODE` AS `CONTAINER_CODE`,
			`APP_PALLET_EXTENSION`.`PWEEK` AS `PWEEK`,
			`APP_PALLET_EXTENSION`.`PDAY` AS `PDAY`,
			`APP_PALLET_EXTENSION`.`PMONTH` AS `PMONTH`,
			`APP_PALLET_EXTENSION`.`PYEAR` AS `PYEAR`,
			`APP_SUPPLIER`.`SUPPLIER_TYPE` AS `SUPPLIER_TYPE`,
			`APP_SUPPLIER`.`DESCRIPTION` AS `SUPPLIER_DESCRIPTION`,
			`APP_PALLET`.`LOCATION_ID` AS `LOCATION_ID`,
			`APP_PALLET`.`MATERIAL` AS `MATERIAL`,
			`APP_PALLET`.`BATCH_NUMBER` AS `BATCH_NUMBER`,
			`APP_PALLET`.`PROCESS_ORDER` AS `PROCESS_ORDER`,
			`APP_PALLET`.`DATE_OF_MANUFACTURE` AS `DATE_OF_MANUFACTURE`,
			`APP_PALLET`.`STATUS` AS `PALLET_STATUS`,
			`APP_PALLET`.`MHN_NUMBER` AS `MHN_NUMBER`,
			`APP_PALLET`.`DECISION` AS `DECISION`,
			`APP_SAMPLE_DEFECT_TYPE`.`DESCRIPTION` AS `DEFECT_TYPE_DESCRIPTION`,
			`APP_SAMPLE_DEFECT_TYPE`.`NON_LEAKING_DATA` AS `NON_LEAKING_DATA`,
			`APP_SAMPLE_DEFECT_TYPE`.`LEAKING_DATA` AS `LEAKING_DATA`,
			`APP_SAMPLE_DEFECT_ID`.`DESCRIPTION` AS `DEFECT_ID_DESCRIPTION` 
		FROM
			(((((
								`APP_PALLET_SAMPLES`
								LEFT JOIN `APP_PALLET_EXTENSION` ON ((
										`APP_PALLET_SAMPLES`.`SSCC` = `APP_PALLET_EXTENSION`.`SSCC` 
									)))
							LEFT JOIN `APP_SUPPLIER` ON ((
									`APP_PALLET_EXTENSION`.`SUPPLIER_ID1` = `APP_SUPPLIER`.`SUPPLIER_ID` 
								)))
						LEFT JOIN `APP_SAMPLE_DEFECT_ID` ON ((
								`APP_PALLET_SAMPLES`.`DEFECT_ID` = `APP_SAMPLE_DEFECT_ID`.`DEFECT_ID` 
							)))
					LEFT JOIN `APP_SAMPLE_DEFECT_TYPE` ON ((
							`APP_PALLET_SAMPLES`.`DEFECT_TYPE` = `APP_SAMPLE_DEFECT_TYPE`.`DEFECT_TYPE` 
						)))
				LEFT JOIN `APP_PALLET` ON ((
					`APP_PALLET_SAMPLES`.`SSCC` = `APP_PALLET`.`SSCC` 
			)));
    </statement>
    
    <statement>
		CREATE OR REPLACE VIEW `view_sorting_qty_diffs` AS SELECT
			`APP_PALLET_EXTENSION`.`SSCC` AS `SSCC`,
			`APP_PALLET_EXTENSION`.`PALLET_QUANTITY` AS `PALLET_QUANTITY`,
			`APP_PALLET`.`QUANTITY` AS `QUANTITY`,
			`APP_PALLET`.`DATE_OF_MANUFACTURE` AS `DATE_OF_MANUFACTURE`,
			`APP_PALLET`.`MATERIAL` AS `MATERIAL`,
			`APP_PALLET`.`BATCH_NUMBER` AS `BATCH_NUMBER`,
			`APP_PALLET`.`STATUS` AS `STATUS`,
			`APP_PALLET`.`MHN_NUMBER` AS `MHN_NUMBER`,
			`APP_PALLET`.`DECISION` AS `DECISION`,
			`APP_MATERIAL_BATCH`.`STATUS` AS `BATCH_STATUS`,
			date_format( max( `APP_PALLET_SAMPLES`.`SAMPLE_DATE` ), '%d/%m/%y %T' ) AS `SAMPLE_DATE` 
		FROM
			(((
						`APP_PALLET_EXTENSION`
						LEFT JOIN `APP_PALLET` ON ((
								`APP_PALLET_EXTENSION`.`SSCC` = `APP_PALLET`.`SSCC` 
							)))
					LEFT JOIN `APP_MATERIAL_BATCH` ON (((
								`APP_PALLET`.`MATERIAL` = `APP_MATERIAL_BATCH`.`MATERIAL` 
								) 
						AND ( `APP_PALLET`.`BATCH_NUMBER` = `APP_MATERIAL_BATCH`.`BATCH_NUMBER` ))))
				LEFT JOIN `APP_PALLET_SAMPLES` ON ((
						`APP_PALLET`.`SSCC` = `APP_PALLET_SAMPLES`.`SSCC` 
					))) 
		WHERE
			( `APP_PALLET_EXTENSION`.`PALLET_QUANTITY` &lt;&gt; `APP_PALLET`.`QUANTITY` ) 
		GROUP BY
			`APP_PALLET_EXTENSION`.`SSCC`,
			`APP_PALLET_EXTENSION`.`PALLET_QUANTITY`,
			`APP_PALLET`.`QUANTITY`,
			`APP_PALLET`.`DATE_OF_MANUFACTURE`,
			`APP_PALLET`.`MATERIAL`,
			`APP_PALLET`.`BATCH_NUMBER`,
			`APP_PALLET`.`STATUS`,
			`APP_PALLET`.`MHN_NUMBER`,
			`APP_PALLET`.`DECISION`,
	        `APP_MATERIAL_BATCH`.`STATUS`;
    </statement>

</DDL>
